<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherVision Pro - Умный прогноз погоды</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"/>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f72585;
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-light: #f8f9fa;
            --text-dark: #2b2d42;
            --sun: #FFD700;
            --rain: #4682B4;
            --snow: #E0FFFF;
            --cloud: #B0C4DE;
            --thunder: #9400D3;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-dark);
            background-attachment: fixed;
            background-size: cover;
            transition: all 1s ease;
        }
        
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        
        .weather-app {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .weather-container {
            background: var(--card-bg);
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            width: 100%;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(0);
            transition: all 0.5s ease;
            position: relative;
            z-index: 10;
        }
        
        .weather-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
        }
        
        .weather-header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: var(--text-light);
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .weather-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            animation: pulse 15s infinite linear;
            z-index: 1;
        }
        
        @keyframes pulse {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .header-content {
            position: relative;
            z-index: 2;
        }
        
        .weather-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .weather-subtitle {
            font-size: 14px;
            opacity: 0.8;
            font-weight: 400;
        }
        
        .search-container {
            display: flex;
            margin-top: 20px;
            position: relative;
            z-index: 2;
        }
        
        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 30px 0 0 30px;
            font-size: 16px;
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: white;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .search-button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 0 30px 30px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .search-button:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        .location-button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 0 15px;
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .location-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .weather-content {
            padding: 30px;
            position: relative;
        }
        
        .current-weather {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .location-info {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .location {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            color: var(--text-dark);
        }
        
        .location svg {
            margin-right: 8px;
            color: var(--primary);
        }
        
        .favorite-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #ccc;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .favorite-btn.active {
            color: var(--warning);
        }
        
        .date-time {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            width: 100%;
            text-align: left;
        }
        
        .weather-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .weather-icon-container {
            position: relative;
            width: 150px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .weather-icon-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1) 0%, rgba(67, 97, 238, 0.05) 100%);
            animation: pulseScale 4s infinite ease-in-out;
        }
        
        @keyframes pulseScale {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .weather-icon {
            width: 120px;
            height: 120px;
            z-index: 1;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1));
            transition: all 0.5s ease;
        }
        
        .weather-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }
        
        .temperature-container {
            text-align: right;
            flex: 1;
        }
        
        .temperature {
            font-size: 72px;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }
        
        .temperature-unit {
            font-size: 36px;
            position: absolute;
            top: 5px;
            right: -25px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .description {
            font-size: 20px;
            color: var(--text-dark);
            margin-bottom: 15px;
            text-transform: capitalize;
            font-weight: 500;
        }
        
        .details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            width: 100%;
            margin-top: 20px;
        }
        
        .detail-item {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .detail-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .detail-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .detail-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .detail-label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        .forecast {
            margin-top: 30px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-dark);
            display: flex;
            align-items: center;
        }
        
        .section-title svg {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .forecast-items {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) rgba(0,0,0,0.1);
        }
        
        .forecast-items::-webkit-scrollbar {
            height: 6px;
        }
        
        .forecast-items::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .forecast-items::-webkit-scrollbar-thumb {
            background-color: var(--primary);
            border-radius: 10px;
        }
        
        .forecast-item {
            min-width: 120px;
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            flex-shrink: 0;
            cursor: pointer;
        }
        
        .forecast-item.active {
            background: rgba(67, 97, 238, 0.2);
            border: 1px solid var(--primary);
        }
        
        .forecast-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .forecast-day {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        
        .forecast-date {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .forecast-icon {
            width: 50px;
            height: 50px;
            margin: 5px auto;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.1));
        }
        
        .forecast-temp {
            font-weight: 600;
            color: var(--primary);
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        
        .forecast-temp-max {
            color: var(--warning);
        }
        
        .hourly-forecast {
            margin-top: 30px;
        }
        
        .hourly-items {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 15px;
        }
        
        .hourly-item {
            min-width: 80px;
            text-align: center;
            padding: 15px 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            flex-shrink: 0;
        }
        
        .hourly-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .hourly-time {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
            font-size: 14px;
        }
        
        .hourly-icon {
            width: 40px;
            height: 40px;
            margin: 5px auto;
        }
        
        .hourly-temp {
            font-weight: 600;
            color: var(--primary);
            font-size: 16px;
        }
        
        .loading {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dark);
            font-size: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(67, 97, 238, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            color: var(--warning);
            text-align: center;
            margin-top: 15px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }
        
        .weather-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.3;
        }
        
        .additional-info {
            margin-top: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .info-card-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .info-card-title svg {
            margin-right: 8px;
            color: var(--primary);
        }
        
        .info-card-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .sun-times {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .sun-time {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .sun-icon {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .sunrise-icon {
            color: #ff9e00;
        }
        
        .sunset-icon {
            color: #ff6b00;
        }
        
        .sun-time-label {
            font-size: 12px;
            color: #666;
        }
        
        .sun-time-value {
            font-size: 14px;
            font-weight: 500;
        }
        
        .favorites-panel {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .favorites-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .favorite-city {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .favorite-city:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        
        .favorite-city-info {
            display: flex;
            flex-direction: column;
        }
        
        .favorite-city-name {
            font-weight: 600;
            font-size: 16px;
            color: var(--text-dark);
        }
        
        .favorite-city-time {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .favorite-city-weather {
            display: flex;
            align-items: center;
        }
        
        .favorite-city-temp {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
            margin-right: 10px;
        }
        
        .favorite-city-icon {
            width: 40px;
            height: 40px;
        }
        
        .favorite-city .remove-btn {
            margin-left: 15px;
            color: #ff6b6b;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            padding: 5px;
        }
        
        .air-quality {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .air-quality-index {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        
        .air-quality-level {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .air-quality-good {
            background-color: #4CAF50;
            color: white;
        }
        
        .air-quality-moderate {
            background-color: #FFEB3B;
            color: #333;
        }
        
        .air-quality-unhealthy {
            background-color: #FF9800;
            color: white;
        }
        
        .air-quality-very-unhealthy {
            background-color: #F44336;
            color: white;
        }
        
        .air-quality-hazardous {
            background-color: #9C27B0;
            color: white;
        }
        
        .air-quality-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .air-quality-item {
            font-size: 14px;
        }
        
        .air-quality-item span {
            font-weight: 600;
            color: var(--primary);
        }
        
        .map-container {
            height: 200px;
            margin-top: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #map {
            height: 100%;
            width: 100%;
            border-radius: 15px;
        }
        
        .units-switcher {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }
        
        .unit-btn {
            background: rgba(67, 97, 238, 0.1);
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .unit-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Анимации для разных погодных условий */
        .animate-rain {
            position: relative;
            overflow: hidden;
        }
        
        .animate-rain::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path d="M20,5 L20,15 M30,5 L30,20 M40,5 L40,25 M50,5 L50,15 M60,5 L60,20 M70,5 L70,25 M80,5 L80,15" stroke="%234361ee" stroke-width="2"/></svg>');
            animation: rain 1s linear infinite;
            pointer-events: none;
        }
        
        @keyframes rain {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        
        .animate-snow {
            position: relative;
            overflow: hidden;
        }
        
        .animate-snow::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><circle cx="10" cy="10" r="1.5" fill="%23ffffff"/><circle cx="25" cy="25" r="1" fill="%23ffffff"/><circle cx="40" cy="5" r="1.2" fill="%23ffffff"/><circle cx="60" cy="15" r="1" fill="%23ffffff"/><circle cx="75" cy="30" r="1.5" fill="%23ffffff"/><circle cx="90" cy="10" r="1.2" fill="%23ffffff"/></svg>');
            animation: snow 10s linear infinite;
            pointer-events: none;
        }
        
        @keyframes snow {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        
        .animate-clouds {
            position: relative;
            overflow: hidden;
        }
        
        .animate-clouds::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 50" opacity="0.05"><path d="M20,25 Q25,15 35,20 Q40,5 55,10 Q70,5 75,20 Q85,15 90,25 Q85,35 75,30 Q70,45 55,40 Q40,45 35,30 Q25,35 20,25" fill="%234361ee"/></svg>');
            animation: clouds 30s linear infinite;
            pointer-events: none;
        }
        
        @keyframes clouds {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .animate-sun {
            position: relative;
            overflow: hidden;
        }
        
        .animate-sun::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,200,0,0.05) 0%, rgba(255,200,0,0) 70%);
            animation: sunPulse 4s infinite alternate;
            pointer-events: none;
        }
        
        @keyframes sunPulse {
            0% { transform: scale(1); opacity: 0.05; }
            100% { transform: scale(1.2); opacity: 0.1; }
        }
        
        .animate-thunder {
            position: relative;
            overflow: hidden;
        }
        
        .animate-thunder::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(148,0,211,0.05) 0%, rgba(148,0,211,0) 70%);
            animation: thunderFlash 8s infinite;
            pointer-events: none;
        }
        
        @keyframes thunderFlash {
            0%, 30%, 33%, 63%, 65%, 100% { opacity: 0; }
            31%, 32%, 64% { opacity: 0.2; }
        }
        
        /* Адаптивные стили */
        @media (max-width: 1024px) {
            .weather-app {
                max-width: 800px;
            }
            
            .details {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .additional-info {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .weather-main {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .temperature-container {
                text-align: left;
                width: 100%;
                margin-top: 15px;
            }
            
            .temperature {
                font-size: 60px;
            }
            
            .favorites-list {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 600px) {
            .weather-header {
                padding: 20px 15px;
            }
            
            .weather-title {
                font-size: 24px;
            }
            
            .weather-content {
                padding: 20px 15px;
            }
            
            .temperature {
                font-size: 48px;
            }
            
            .details {
                grid-template-columns: 1fr;
            }
            
            .forecast-item, .hourly-item {
                min-width: 100px;
                padding: 12px;
            }
            
            .air-quality-details {
                grid-template-columns: 1fr;
            }
            
            .favorite-city {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .favorite-city-weather {
                width: 100%;
                justify-content: space-between;
                margin-top: 10px;
            }
            
            .remove-btn {
                align-self: flex-end;
            }
        }
        
        @media (max-width: 480px) {
            .search-container {
                flex-direction: column;
            }
            
            .search-input {
                border-radius: 30px;
                margin-bottom: 10px;
            }
            
            .search-button {
                border-radius: 30px;
                padding: 12px;
            }
            
            .location-button {
                margin-left: 0;
                margin-top: 10px;
                padding: 12px;
            }
            
            .forecast-item, .hourly-item {
                min-width: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="weather-app">
        <div class="weather-container" id="weather-container">
            <div class="weather-header">
                <div class="header-content">
                    <h1 class="weather-title">WeatherVision Pro</h1>
                    <p class="weather-subtitle">Умный прогноз погоды с точностью до минуты</p>
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Введите город..." id="city-input">
                        <button class="search-button" id="search-button">
                            <span class="material-symbols-outlined">search</span>
                        </button>
                        <button class="location-button" id="location-button" title="Мое местоположение">
                            <span class="material-symbols-outlined">my_location</span>
                        </button>
                    </div>
                    <div id="error-message" class="error-message"></div>
                </div>
            </div>
            
            <div class="weather-content">
                <div class="tabs">
                    <div class="tab active" data-tab="current">Текущая погода</div>
                    <div class="tab" data-tab="favorites">Избранное</div>
                </div>
                
                <div class="tab-content active" id="current-tab">
                    <div class="units-switcher">
                        <button class="unit-btn active" data-unit="metric">°C, м/с</button>
                        <button class="unit-btn" data-unit="imperial">°F, миль/ч</button>
                    </div>
                    
                    <div id="current-weather" class="current-weather">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            Определяем ваше местоположение...
                        </div>
                    </div>
                    
                    <div class="additional-info" id="additional-info"></div>
                    
                    <div id="air-quality" class="air-quality" style="display: none;"></div>
                    
                    <div id="hourly-forecast" class="hourly-forecast" style="display: none;">
                        <h3 class="section-title">
                            <span class="material-symbols-outlined">schedule</span>
                            Почасовой прогноз
                        </h3>
                        <div id="hourly-items" class="hourly-items"></div>
                    </div>
                    
                    <div class="forecast">
                        <h3 class="section-title">
                            <span class="material-symbols-outlined">calendar_month</span>
                            Прогноз на 5 дней
                        </h3>
                        <div id="forecast-items" class="forecast-items"></div>
                    </div>
                    
                    <div id="map-container" class="map-container" style="display: none;">
                        <div id="map"></div>
                    </div>
                </div>
                
                <div class="tab-content" id="favorites-tab">
                    <div class="favorites-panel">
                        <h3 class="section-title">
                            <span class="material-symbols-outlined">favorite</span>
                            Избранные города
                        </h3>
                        <div id="favorites-list" class="favorites-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                Загрузка избранных городов...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiKey = 'e7704bc895b4a8d2dfd4a29d404285b6'; // Замените на ваш API ключ OpenWeatherMap
            const cityInput = document.getElementById('city-input');
            const searchButton = document.getElementById('search-button');
            const locationButton = document.getElementById('location-button');
            const currentWeatherDiv = document.getElementById('current-weather');
            const forecastItemsDiv = document.getElementById('forecast-items');
            const hourlyItemsDiv = document.getElementById('hourly-items');
            const errorMessageDiv = document.getElementById('error-message');
            const additionalInfoDiv = document.getElementById('additional-info');
            const airQualityDiv = document.getElementById('air-quality');
            const hourlyForecastDiv = document.getElementById('hourly-forecast');
            const mapContainerDiv = document.getElementById('map-container');
            const mapDiv = document.getElementById('map');
            const favoritesListDiv = document.getElementById('favorites-list');
            const weatherContainer = document.getElementById('weather-container');
            const body = document.body;
            const unitButtons = document.querySelectorAll('.unit-btn');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            let currentUnit = 'metric';
            let currentLocation = null;
            let map = null;
            let marker = null;
            let mapInitialized = false;
            let favorites = JSON.parse(localStorage.getItem('weatherFavorites')) || [];
            let selectedForecastDay = 0;
            
            // Инициализация приложения
            initApp();
            
            function initApp() {
                // Настройка обработчиков событий
                setupEventListeners();
                
                // Пытаемся определить местоположение
                detectLocation();
            }
            
            function setupEventListeners() {
                searchButton.addEventListener('click', function() {
                    const city = cityInput.value.trim();
                    if (city) {
                        fetchWeather(city);
                    }
                });
                
                cityInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const city = cityInput.value.trim();
                        if (city) {
                            fetchWeather(city);
                        }
                    }
                });
                
                locationButton.addEventListener('click', detectLocation);
                
                unitButtons.forEach(btn => {
                    btn.addEventListener('click', function() {
                        unitButtons.forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        currentUnit = this.dataset.unit;
                        if (currentLocation) {
                            fetchWeather(currentLocation);
                        }
                    });
                });
                
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        const tabId = this.dataset.tab;
                        tabContents.forEach(content => content.classList.remove('active'));
                        document.getElementById(`${tabId}-tab`).classList.add('active');
                        
                        if (tabId === 'favorites') {
                            updateFavoritesWeather();
                        }
                    });
                });
            }
            
            function detectLocation() {
                if (!navigator.geolocation) {
                    showError('Геолокация не поддерживается вашим браузером');
                    fetchWeather('Москва'); // По умолчанию
                    return;
                }
                
                currentWeatherDiv.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Определяем ваше местоположение...
                    </div>
                `;
                
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        fetchWeatherByCoords(lat, lon);
                    },
                    error => {
                        console.error('Geolocation error:', error);
                        showError('Не удалось определить местоположение. Показываем погоду для Москвы');
                        fetchWeather('Москва');
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            }
            
            function fetchWeather(location) {
                errorMessageDiv.textContent = '';
                currentWeatherDiv.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Загрузка данных о погоде...
                    </div>
                `;
                forecastItemsDiv.innerHTML = '';
                hourlyItemsDiv.innerHTML = '';
                additionalInfoDiv.innerHTML = '';
                airQualityDiv.style.display = 'none';
                hourlyForecastDiv.style.display = 'none';
                mapContainerDiv.style.display = 'none';
                
                currentLocation = location;
                cityInput.value = location;
                
                // Запрос текущей погоды
                fetch(`https://api.openweathermap.org/data/2.5/weather?q=${location}&units=${currentUnit}&appid=${apiKey}&lang=ru`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Город не найден');
                        }
                        return response.json();
                    })
                    .then(data => {
                        displayCurrentWeather(data);
                        fetchAirQuality(data.coord.lat, data.coord.lon);
                        fetchHourlyForecast(data.coord.lat, data.coord.lon);
                        initMap(data.coord.lat, data.coord.lon, data.name);
                        
                        // Запрос прогноза погоды
                        return fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${location}&units=${currentUnit}&appid=${apiKey}&lang=ru`);
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Ошибка загрузки прогноза');
                        }
                        return response.json();
                    })
                    .then(data => {
                        displayForecast(data);
                    })
                    .catch(error => {
                        currentWeatherDiv.innerHTML = `
                            <div class="loading">
                                <span class="material-symbols-outlined" style="font-size: 48px; color: var(--warning);">error</span>
                                Введите город для отображения погоды
                            </div>
                        `;
                        errorMessageDiv.textContent = error.message;
                    });
            }
            
            function fetchWeatherByCoords(lat, lon) {
                errorMessageDiv.textContent = '';
                currentWeatherDiv.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Загрузка данных о погоде...
                    </div>
                `;
                
                fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=${currentUnit}&appid=${apiKey}&lang=ru`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Ошибка получения данных');
                        }
                        return response.json();
                    })
                    .then(data => {
                        displayCurrentWeather(data);
                        fetchAirQuality(lat, lon);
                        fetchHourlyForecast(lat, lon);
                        initMap(lat, lon, data.name);
                        currentLocation = data.name;
                        cityInput.value = data.name;
                        
                        return fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=${currentUnit}&appid=${apiKey}&lang=ru`);
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Ошибка загрузки прогноза');
                        }
                        return response.json();
                    })
                    .then(data => {
                        displayForecast(data);
                    })
                    .catch(error => {
                        currentWeatherDiv.innerHTML = `
                            <div class="loading">
                                <span class="material-symbols-outlined" style="font-size: 48px; color: var(--warning);">error</span>
                                ${error.message}
                            </div>
                        `;
                    });
            }
            
            function fetchAirQuality(lat, lon) {
                fetch(`https://api.openweathermap.org/data/2.5/air_pollution?lat=${lat}&lon=${lon}&appid=${apiKey}`)
                    .then(response => response.json())
                    .then(data => {
                        displayAirQuality(data);
                    })
                    .catch(error => {
                        console.error('Air quality error:', error);
                    });
            }
            
            function fetchHourlyForecast(lat, lon) {
                fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&units=${currentUnit}&appid=${apiKey}&lang=ru&cnt=40`)
                    .then(response => response.json())
                    .then(data => {
                        displayHourlyForecast(data, selectedForecastDay);
                    })
                    .catch(error => {
                        console.error('Hourly forecast error:', error);
                    });
            }
            
            function displayCurrentWeather(data) {
                const weather = data.weather[0];
                const iconUrl = `https://openweathermap.org/img/wn/${weather.icon}@4x.png`;
                const date = new Date(data.dt * 1000);
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                const dateString = date.toLocaleDateString('ru-RU', options);
                
                // Проверяем, есть ли город в избранных
                const isFavorite = favorites.some(fav => fav.name === data.name && fav.country === data.sys.country);
                
                // Применяем анимации в зависимости от типа погоды
                applyWeatherEffects(weather.main, weather.description);
                
                currentWeatherDiv.innerHTML = `
                    <div class="location-info">
                        <div class="location">
                            <span class="material-symbols-outlined">location_on</span>
                            ${data.name}, ${data.sys.country}
                        </div>
                        <button class="favorite-btn ${isFavorite ? 'active' : ''}" id="favorite-btn">
                            <span class="material-symbols-outlined">${isFavorite ? 'favorite' : 'favorite_border'}</span>
                        </button>
                    </div>
                    <div class="date-time">${dateString}</div>
                    
                    <div class="weather-main">
                        <div class="weather-icon-container">
                            <div class="weather-icon-bg"></div>
                            <img src="${iconUrl}" alt="${weather.description}" class="weather-icon">
                        </div>
                        <div class="temperature-container">
                            <div class="temperature">${Math.round(data.main.temp)}<span class="temperature-unit">${currentUnit === 'metric' ? 'C' : 'F'}</span></div>
                            <div class="description">${weather.description}</div>
                        </div>
                    </div>
                    
                    <div class="details">
                        <div class="detail-item">
                            <div class="detail-icon">
                                <span class="material-symbols-outlined">device_thermostat</span>
                            </div>
                            <div class="detail-value">${Math.round(data.main.feels_like)}°${currentUnit === 'metric' ? 'C' : 'F'}</div>
                            <div class="detail-label">Ощущается как</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">
                                <span class="material-symbols-outlined">humidity_percentage</span>
                            </div>
                            <div class="detail-value">${data.main.humidity}%</div>
                            <div class="detail-label">Влажность</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-icon">
                                <span class="material-symbols-outlined">air</span>
                            </div>
                            <div class="detail-value">${Math.round(data.wind.speed)} ${currentUnit === 'metric' ? 'м/с' : 'миль/ч'}</div>
                            <div class="detail-label">Ветер</div>
                        </div>
                    </div>
                `;
                
                // Добавляем обработчик для кнопки избранного
                document.getElementById('favorite-btn').addEventListener('click', function() {
                    toggleFavorite(data.name, data.sys.country, data.coord.lat, data.coord.lon);
                });
                
                // Добавляем дополнительную информацию
                additionalInfoDiv.innerHTML = `
                    <div class="info-card">
                        <div class="info-card-title">
                            <span class="material-symbols-outlined">visibility</span>
                            Видимость
                        </div>
                        <div class="info-card-value">${data.visibility / 1000} км</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">
                            <span class="material-symbols-outlined">speed</span>
                            Давление
                        </div>
                        <div class="info-card-value">${Math.round(data.main.pressure * 0.750062)} мм рт. ст.</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">
                            <span class="material-symbols-outlined">cloud</span>
                            Облачность
                        </div>
                        <div class="info-card-value">${data.clouds.all}%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-card-title">
                            <span class="material-symbols-outlined">wb_twilight</span>
                            Восход и закат
                        </div>
                        <div class="sun-times">
                            <div class="sun-time">
                                <div class="sun-icon sunrise-icon">
                                    <span class="material-symbols-outlined">clear_day</span>
                                </div>
                                <div class="sun-time-value">${new Date(data.sys.sunrise * 1000).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</div>
                                <div class="sun-time-label">Восход</div>
                            </div>
                            <div class="sun-time">
                                <div class="sun-icon sunset-icon">
                                    <span class="material-symbols-outlined">clear_night</span>
                                </div>
                                <div class="sun-time-value">${new Date(data.sys.sunset * 1000).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}</div>
                                <div class="sun-time-label">Закат</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            function displayAirQuality(data) {
                const aqi = data.list[0].main.aqi;
                const components = data.list[0].components;
                
                let aqiLevel = '';
                let aqiClass = '';
                let aqiDescription = '';
                
                switch(aqi) {
                    case 1:
                        aqiLevel = 'Хорошо';
                        aqiClass = 'air-quality-good';
                        aqiDescription = 'Качество воздуха удовлетворительное, риск для здоровья отсутствует или незначителен.';
                        break;
                    case 2:
                        aqiLevel = 'Умеренно';
                        aqiClass = 'air-quality-moderate';
                        aqiDescription = 'Качество воздуха приемлемое, однако некоторые загрязнители могут представлять умеренную угрозу для здоровья.';
                        break;
                    case 3:
                        aqiLevel = 'Нездорово';
                        aqiClass = 'air-quality-unhealthy';
                        aqiDescription = 'Члены чувствительных групп могут испытывать проблемы со здоровьем.';
                        break;
                    case 4:
                        aqiLevel = 'Очень нездорово';
                        aqiClass = 'air-quality-very-unhealthy';
                        aqiDescription = 'Возможны серьезные последствия для здоровья у всех групп населения.';
                        break;
                    case 5:
                        aqiLevel = 'Опасно';
                        aqiClass = 'air-quality-hazardous';
                        aqiDescription = 'Чрезвычайная ситуация, все население может пострадать.';
                        break;
                    default:
                        aqiLevel = 'Неизвестно';
                }
                
                airQualityDiv.innerHTML = `
                    <h3 class="section-title">
                        <span class="material-symbols-outlined">airwave</span>
                        Качество воздуха
                    </h3>
                    <div class="air-quality-index">
                        Индекс AQI: ${aqi}
                        <span class="air-quality-level ${aqiClass}">${aqiLevel}</span>
                    </div>
                    <p>${aqiDescription}</p>
                    <div class="air-quality-details">
                        <div class="air-quality-item"><span>CO:</span> ${components.co.toFixed(1)} µg/m³</div>
                        <div class="air-quality-item"><span>NO₂:</span> ${components.no2.toFixed(1)} µg/m³</div>
                        <div class="air-quality-item"><span>O₃:</span> ${components.o3.toFixed(1)} µg/m³</div>
                        <div class="air-quality-item"><span>SO₂:</span> ${components.so2.toFixed(1)} µg/m³</div>
                        <div class="air-quality-item"><span>PM2.5:</span> ${components.pm2_5.toFixed(1)} µg/m³</div>
                        <div class="air-quality-item"><span>PM10:</span> ${components.pm10.toFixed(1)} µg/m³</div>
                    </div>
                `;
                airQualityDiv.style.display = 'block';
            }
            
            function displayHourlyForecast(data, dayIndex = 0) {
                // Фильтруем данные для выбранного дня
                const startDate = new Date();
                startDate.setDate(startDate.getDate() + dayIndex);
                startDate.setHours(0, 0, 0, 0);
                
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + 1);
                
                const hourlyData = data.list.filter(item => {
                    const itemDate = new Date(item.dt * 1000);
                    return itemDate >= startDate && itemDate < endDate;
                }).slice(0, 24);
                
                hourlyItemsDiv.innerHTML = hourlyData.map(item => {
                    const date = new Date(item.dt * 1000);
                    const timeString = date.toLocaleTimeString('ru-RU', {hour: '2-digit'});
                    const iconUrl = `https://openweathermap.org/img/wn/${item.weather[0].icon}.png`;
                    const temp = Math.round(item.main.temp);
                    
                    return `
                        <div class="hourly-item">
                            <div class="hourly-time">${timeString}</div>
                            <img src="${iconUrl}" alt="${item.weather[0].description}" class="hourly-icon">
                            <div class="hourly-temp">${temp}°${currentUnit === 'metric' ? 'C' : 'F'}</div>
                        </div>
                    `;
                }).join('');
                
                hourlyForecastDiv.style.display = 'block';
            }
            
            function displayForecast(data) {
                // Фильтруем данные для получения одного прогноза в день (в 12:00)
                const dailyForecast = data.list.filter(item => {
                    const date = new Date(item.dt * 1000);
                    return date.getHours() >= 11 && date.getHours() <= 13;
                }).slice(0, 5);
                
                forecastItemsDiv.innerHTML = dailyForecast.map((item, index) => {
                    const date = new Date(item.dt * 1000);
                    const dayNames = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];
                    const dayName = dayNames[date.getDay()];
                    const dateString = date.toLocaleDateString('ru-RU', {day: 'numeric', month: 'short'});
                    const iconUrl = `https://openweathermap.org/img/wn/${item.weather[0].icon}.png`;
                    const tempMax = Math.round(item.main.temp_max);
                    const tempMin = Math.round(item.main.temp_min);
                    
                    return `
                        <div class="forecast-item ${index === selectedForecastDay ? 'active' : ''}" data-index="${index}">
                            <div class="forecast-day">${dayName}</div>
                            <div class="forecast-date">${dateString}</div>
                            <img src="${iconUrl}" alt="${item.weather[0].description}" class="forecast-icon">
                            <div class="forecast-temp">
                                <span class="forecast-temp-max">${tempMax}°</span>
                                <span>${tempMin}°</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Добавляем обработчики для элементов прогноза
                document.querySelectorAll('.forecast-item').forEach(item => {
                    item.addEventListener('click', function() {
                        document.querySelectorAll('.forecast-item').forEach(i => i.classList.remove('active'));
                        this.classList.add('active');
                        selectedForecastDay = parseInt(this.dataset.index);
                        displayHourlyForecast(data, selectedForecastDay);
                    });
                });
                
                // Показываем почасовой прогноз для первого дня
                displayHourlyForecast(data, selectedForecastDay);
            }
            
            function initMap(lat, lon, name = 'Текущее местоположение') {
                mapContainerDiv.style.display = 'block';
                
                if (!mapInitialized) {
                    // Инициализация карты
                    map = L.map('map').setView([lat, lon], 12);
                    
                    // Добавляем слой OpenStreetMap
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(map);
                    
                    // Добавляем маркер
                    marker = L.marker([lat, lon]).addTo(map)
                        .bindPopup(`<b>${name}</b><br>Широта: ${lat.toFixed(4)}, Долгота: ${lon.toFixed(4)}`)
                        .openPopup();
                    
                    mapInitialized = true;
                } else {
                    // Обновляем позицию карты и маркера
                    map.setView([lat, lon], 12);
                    marker.setLatLng([lat, lon])
                        .setPopupContent(`<b>${name}</b><br>Широта: ${lat.toFixed(4)}, Долгота: ${lon.toFixed(4)}`)
                        .openPopup();
                }
            }
            
            function toggleFavorite(name, country, lat, lon) {
                const favoriteBtn = document.getElementById('favorite-btn');
                const index = favorites.findIndex(fav => fav.name === name && fav.country === country);
                
                if (index === -1) {
                    // Добавляем в избранное
                    favorites.push({ name, country, lat, lon });
                    favoriteBtn.innerHTML = '<span class="material-symbols-outlined">favorite</span>';
                    favoriteBtn.classList.add('active');
                } else {
                    // Удаляем из избранного
                    favorites.splice(index, 1);
                    favoriteBtn.innerHTML = '<span class="material-symbols-outlined">favorite_border</span>';
                    favoriteBtn.classList.remove('active');
                }
                
                // Сохраняем в localStorage
                localStorage.setItem('weatherFavorites', JSON.stringify(favorites));
                updateFavoritesList();
            }
            
            function updateFavoritesList() {
                if (favorites.length === 0) {
                    favoritesListDiv.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #666;">
                            <span class="material-symbols-outlined" style="font-size: 48px; margin-bottom: 10px;">favorite</span>
                            <p>Нет избранных городов</p>
                            <p>Добавьте город в избранное, нажав на сердечко</p>
                        </div>
                    `;
                    return;
                }
                
                favoritesListDiv.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        Обновление данных...
                    </div>
                `;
                
                // Загружаем погоду для всех избранных городов
                const promises = favorites.map(fav => {
                    return fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${fav.lat}&lon=${fav.lon}&units=${currentUnit}&appid=${apiKey}&lang=ru`)
                        .then(response => response.json())
                        .catch(error => {
                            console.error('Error fetching favorite city:', error);
                            return null;
                        });
                });
                
                Promise.all(promises).then(results => {
                    const validResults = results.filter(r => r !== null);
                    
                    if (validResults.length === 0) {
                        favoritesListDiv.innerHTML = `
                            <div style="text-align: center; padding: 20px; color: #666;">
                                <span class="material-symbols-outlined" style="font-size: 48px; margin-bottom: 10px;">error</span>
                                <p>Не удалось загрузить данные для избранных городов</p>
                            </div>
                        `;
                        return;
                    }
                    
                    favoritesListDiv.innerHTML = validResults.map(city => {
                        const weather = city.weather[0];
                        const iconUrl = `https://openweathermap.org/img/wn/${weather.icon}.png`;
                        const date = new Date(city.dt * 1000);
                        const timeString = date.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'});
                        
                        return `
                            <div class="favorite-city" data-name="${city.name}" data-country="${city.sys.country}">
                                <div class="favorite-city-info">
                                    <div class="favorite-city-name">${city.name}, ${city.sys.country}</div>
                                    <div class="favorite-city-time">${timeString}</div>
                                </div>
                                <div class="favorite-city-weather">
                                    <div class="favorite-city-temp">${Math.round(city.main.temp)}°${currentUnit === 'metric' ? 'C' : 'F'}</div>
                                    <img src="${iconUrl}" alt="${weather.description}" class="favorite-city-icon">
                                    <button class="remove-btn" data-name="${city.name}" data-country="${city.sys.country}">
                                        <span class="material-symbols-outlined">close</span>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // Добавляем обработчики для избранных городов
                    document.querySelectorAll('.favorite-city').forEach(city => {
                        city.addEventListener('click', function(e) {
                            if (!e.target.classList.contains('remove-btn') && !e.target.closest('.remove-btn')) {
                                fetchWeather(`${this.dataset.name},${this.dataset.country}`);
                                // Переключаемся на вкладку текущей погоды
                                document.querySelector('.tab[data-tab="current"]').click();
                            }
                        });
                    });
                    
                    // Добавляем обработчики для кнопок удаления
                    document.querySelectorAll('.remove-btn').forEach(btn => {
                        btn.addEventListener('click', function(e) {
                            e.stopPropagation();
                            const name = this.dataset.name;
                            const country = this.dataset.country;
                            favorites = favorites.filter(fav => !(fav.name === name && fav.country === country));
                            localStorage.setItem('weatherFavorites', JSON.stringify(favorites));
                            updateFavoritesList();
                            
                            // Если удалили текущий город, обновляем кнопку избранного
                            if (currentLocation === name) {
                                const favoriteBtn = document.getElementById('favorite-btn');
                                if (favoriteBtn) {
                                    favoriteBtn.innerHTML = '<span class="material-symbols-outlined">favorite_border</span>';
                                    favoriteBtn.classList.remove('active');
                                }
                            }
                        });
                    });
                });
            }
            
            function updateFavoritesWeather() {
                if (favorites.length > 0) {
                    updateFavoritesList();
                }
            }
            
            function applyWeatherEffects(weatherMain, weatherDesc) {
                // Удаляем предыдущие классы анимаций
                weatherContainer.classList.remove(
                    'animate-rain', 'animate-snow', 'animate-clouds', 'animate-sun', 'animate-thunder'
                );
                
                // Меняем фон body в зависимости от погоды
                let bgGradient = '';
                let animationClass = '';
                
                switch(weatherMain.toLowerCase()) {
                    case 'thunderstorm':
                        bgGradient = 'linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%)';
                        animationClass = 'animate-thunder';
                        break;
                    case 'drizzle':
                    case 'rain':
                        bgGradient = 'linear-gradient(135deg, #3a7bd5 0%, #00d2ff 100%)';
                        animationClass = 'animate-rain';
                        break;
                    case 'snow':
                        bgGradient = 'linear-gradient(135deg, #e6dada 0%, #274046 100%)';
                        animationClass = 'animate-snow';
                        break;
                    case 'clear':
                        if (weatherDesc.includes('ночь') || weatherDesc.includes('вечер')) {
                            bgGradient = 'linear-gradient(135deg, #0F2027 0%, #203A43 50%, #2C5364 100%)';
                        } else {
                            bgGradient = 'linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%)';
                            animationClass = 'animate-sun';
                        }
                        break;
                    case 'clouds':
                        if (weatherDesc.includes('пасмурно')) {
                            bgGradient = 'linear-gradient(135deg, #606c88 0%, #3f4c6b 100%)';
                        } else {
                            bgGradient = 'linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%)';
                        }
                        animationClass = 'animate-clouds';
                        break;
                    case 'mist':
                    case 'smoke':
                    case 'haze':
                    case 'dust':
                    case 'fog':
                    case 'sand':
                    case 'ash':
                        bgGradient = 'linear-gradient(135deg, #BDC3C7 0%, #2C3E50 100%)';
                        animationClass = 'animate-clouds';
                        break;
                    case 'squall':
                    case 'tornado':
                        bgGradient = 'linear-gradient(135deg, #1F1C2C 0%, #928DAB 100%)';
                        break;
                    default:
                        bgGradient = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }
                
                body.style.background = bgGradient;
                if (animationClass) {
                    weatherContainer.classList.add(animationClass);
                }
            }
            
            function showError(message) {
                errorMessageDiv.textContent = message;
                setTimeout(() => {
                    errorMessageDiv.textContent = '';
                }, 5000);
            }
        });
    </script>
</body>
</html>
